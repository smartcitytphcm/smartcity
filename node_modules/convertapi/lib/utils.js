'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.getReadableStream=exports.buildQueryString=exports.detectFormat=exports.buildFileParam=exports.normalizeFilesParam=void 0;var _slicedToArray=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h['return']&&h['return']()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),_path=require('path'),_path2=_interopRequireDefault(_path),_url=require('url'),_url2=_interopRequireDefault(_url),_querystring=require('querystring'),_querystring2=_interopRequireDefault(_querystring),_fs=require('fs'),_fs2=_interopRequireDefault(_fs),_stream=require('stream'),_stream2=_interopRequireDefault(_stream),_result=require('./result'),_result2=_interopRequireDefault(_result),_result_file=require('./result_file'),_result_file2=_interopRequireDefault(_result_file),_upload_result=require('./upload_result'),_upload_result2=_interopRequireDefault(_upload_result);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d('next',a)},function(a){d('throw',a)})}return d('next')})}}const URI_REGEXP=/^https?:/i,DEFAULT_URL_FORMAT='url',normalizeFilesParam=exports.normalizeFilesParam=(()=>{var a=_asyncToGenerator(function*(a){const b=yield a;return b instanceof _result2.default?b.files:Promise.all(b)});return function(){return a.apply(this,arguments)}})(),buildFileParam=exports.buildFileParam=(()=>{var a=_asyncToGenerator(function*(a,b){return URI_REGEXP.test(b)?b:b instanceof _result2.default?b.file.url:b instanceof _result_file2.default?b.url:b instanceof _upload_result2.default?b:a.upload(b)});return function(){return a.apply(this,arguments)}})(),detectFormat=exports.detectFormat=a=>{let b;if(a.Url)return DEFAULT_URL_FORMAT;if(a.File)b=a.File;else if(a.Files){var c=_slicedToArray(a.Files,1);b=c[0]}if(b instanceof _result_file2.default&&(b=b.url),b instanceof _upload_result2.default)return b.fileExt;var d=_url2.default.parse(b);const e=d.pathname;return _path2.default.extname(e).substring(1)},buildQueryString=exports.buildQueryString=a=>{const b={};return Object.keys(a).forEach(c=>{const d=a[c];d instanceof Array?d.forEach((a,d)=>{b[`${c}[${d}]`]=a.toString()}):b[c]=d.toString()}),_querystring2.default.stringify(b)},getReadableStream=exports.getReadableStream=a=>a instanceof _stream2.default.Readable?a:_fs2.default.createReadStream(a);